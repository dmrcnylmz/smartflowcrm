<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Panel ‚Äî AI Call Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0b1120;
            --bg-secondary: #131b2e;
            --bg-card: rgba(19, 27, 46, 0.85);
            --bg-glass: rgba(255, 255, 255, 0.04);
            --border: rgba(255, 255, 255, 0.08);
            --text: #e2e8f0;
            --text-dim: #94a3b8;
            --text-muted: #64748b;
            --blue: #3b82f6;
            --green: #10b981;
            --orange: #f59e0b;
            --red: #ef4444;
            --purple: #8b5cf6;
            --cyan: #06b6d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text);
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at 30% 0%, rgba(59, 130, 246, 0.07) 0%, transparent 60%),
                radial-gradient(ellipse at 70% 100%, rgba(139, 92, 246, 0.05) 0%, transparent 60%);
            z-index: 0;
        }

        .app {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-columns: 260px 1fr;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 32px;
        }

        .sidebar-logo .icon {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
        }

        .sidebar-logo h2 {
            font-size: 16px;
            font-weight: 700;
        }

        .sidebar-logo small {
            color: var(--text-muted);
            font-size: 11px;
            display: block;
        }

        .agent-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 24px;
            text-align: center;
        }

        .agent-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--green), var(--cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
            margin: 0 auto 10px;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }

        .agent-card h3 {
            font-size: 15px;
            font-weight: 600;
        }

        .agent-card p {
            font-size: 12px;
            color: var(--text-muted);
        }

        .agent-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-available .status-dot {
            background: var(--green);
            box-shadow: 0 0 6px var(--green);
        }

        .status-available {
            background: rgba(16, 185, 129, 0.12);
            color: #34d399;
        }

        .sidebar-nav {
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 14px;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
            margin-bottom: 4px;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text);
        }

        .nav-item.active {
            border-left: 3px solid var(--blue);
        }

        .content {
            padding: 24px 28px;
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .content-header h1 {
            font-size: 22px;
            font-weight: 700;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 14px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            backdrop-filter: blur(10px);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            backdrop-filter: blur(10px);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .panel-header {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
            font-weight: 600;
        }

        .panel-body {
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 10px 14px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 10px 14px;
            font-size: 13px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        tr {
            cursor: pointer;
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .b-green {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
        }

        .b-red {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .b-blue {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
        }

        .b-purple {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
        }

        .b-orange {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
        }

        .b-cyan {
            background: rgba(6, 182, 212, 0.15);
            color: #22d3ee;
        }

        /* Sentiment & Intent */
        .sentiment-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .s-positive {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
        }

        .s-neutral {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
        }

        .s-negative {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .intent-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .i-appointment {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
        }

        .i-complaint {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .i-pricing {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
        }

        .i-human {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
        }

        .i-other {
            background: rgba(100, 116, 139, 0.15);
            color: #94a3b8;
        }

        /* Call Detail View */
        .call-detail {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 20px;
        }

        .detail-item .detail-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-item .detail-value {
            font-size: 14px;
            font-weight: 500;
        }

        .ai-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .ai-card h4 {
            font-size: 12px;
            color: var(--cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-card p {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-dim);
        }

        .transcript-box {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            font-size: 12px;
            line-height: 1.8;
            white-space: pre-wrap;
            max-height: 250px;
            overflow-y: auto;
            color: var(--text-dim);
        }

        .back-btn {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
        }

        /* Auth */
        .auth-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 14, 26, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .auth-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 36px;
            width: 400px;
            text-align: center;
        }

        .auth-card h2 {
            margin-bottom: 6px;
        }

        .auth-card p {
            color: var(--text-muted);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .fg {
            margin-bottom: 14px;
            text-align: left;
        }

        .fg label {
            display: block;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 4px;
        }

        .fg select,
        .fg input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .auth-card .btn {
            width: 100%;
            padding: 12px;
            margin-top: 4px;
        }

        .auth-error {
            color: var(--red);
            font-size: 13px;
            margin-top: 8px;
        }

        .loading {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }

        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width:768px) {
            .app {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .stats-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .detail-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-card">
            <div style="font-size:32px;margin-bottom:12px">üéß</div>
            <h2>Agent Panel</h2>
            <p>AI-Powered Agent Workspace</p>
            <div class="fg">
                <label>Tenant</label>
                <select id="loginTenant">
                    <option value="atlas_support">Atlas Support</option>
                    <option value="nova_logistics">Nova Logistics</option>
                </select>
            </div>
            <div class="fg">
                <label>Email</label>
                <input id="loginEmail" value="ayse@atlas.com">
            </div>
            <div class="fg">
                <label>Password</label>
                <input type="password" id="loginPassword" value="password123">
            </div>
            <button class="btn" onclick="doLogin()">Sign In</button>
            <div class="auth-error" id="authError"></div>
        </div>
    </div>

    <div class="app" id="app" style="display:none;">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="icon">üéß</div>
                <div>
                    <h2>Agent</h2><small>AI Call Center</small>
                </div>
            </div>
            <div class="agent-card" id="agentCard">
                <div class="agent-avatar" id="agentAvatar">‚Äî</div>
                <h3 id="agentName">‚Äî</h3>
                <p id="agentRole">‚Äî</p>
                <div class="agent-status status-available"><span class="status-dot"></span> <span
                        id="agentStatus">Available</span></div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="showTab('dashboard')">üìä Dashboard</div>
                <div class="nav-item" onclick="showTab('calls')">üìû My Calls</div>
                <div class="nav-item" onclick="showTab('transcript')">üìù Transcripts</div>
            </nav>
            <div style="margin-top:auto;padding-top:16px;border-top:1px solid var(--border)">
                <div class="nav-item" onclick="logout()">üö™ Logout</div>
            </div>
        </aside>

        <main class="content">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard">
                <div class="content-header">
                    <h1>My Dashboard</h1>
                    <span style="color:var(--text-muted);font-size:13px" id="tenantLabel">‚Äî</span>
                </div>
                <div class="stats-row" id="statsRow">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header"><span>üìû Recent Calls</span><span class="badge b-blue"
                            id="myCallCount">0</span></div>
                    <div class="panel-body" id="recentCallsBody">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calls Tab -->
            <div id="tab-calls" style="display:none;">
                <div class="content-header">
                    <h1>Call History</h1>
                </div>
                <div class="panel">
                    <div class="panel-body" id="allCallsBody">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transcript Tab -->
            <div id="tab-transcript" style="display:none;">
                <div class="content-header">
                    <h1>Transcripts</h1>
                </div>
                <div id="transcriptList"></div>
            </div>

            <!-- Call Detail View -->
            <div id="tab-detail" style="display:none;">
                <div class="content-header">
                    <button class="back-btn" onclick="goBackFromDetail()">‚Üê Back</button>
                </div>
                <div id="detailContent" class="call-detail"></div>
            </div>
        </main>
    </div>

    <script>
        const API = '';
        let token = null, user = null, agentCalls = [], previousTab = 'dashboard';

        document.getElementById('loginTenant').addEventListener('change', function () {
            const emails = { atlas_support: 'ayse@atlas.com', nova_logistics: 'kerem@nova.com' };
            document.getElementById('loginEmail').value = emails[this.value] || '';
        });

        async function doLogin() {
            const tenant = document.getElementById('loginTenant').value;
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            document.getElementById('authError').textContent = '';
            try {
                const res = await fetch(`${API}/api/auth/login`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, tenant_id: tenant })
                });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error);
                token = data.token; user = data.user;
                localStorage.setItem('agent_token', token);
                localStorage.setItem('agent_user', JSON.stringify(user));
                document.getElementById('authOverlay').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                renderProfile();
                loadAgentDashboard();
            } catch (e) { document.getElementById('authError').textContent = e.message; }
        }

        function logout() {
            token = null; user = null;
            localStorage.removeItem('agent_token'); localStorage.removeItem('agent_user');
            document.getElementById('authOverlay').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
        }

        function renderProfile() {
            if (!user) return;
            document.getElementById('agentAvatar').textContent = user.name.split(' ').map(n => n[0]).join('');
            document.getElementById('agentName').textContent = user.name;
            document.getElementById('agentRole').textContent = user.role;
            document.getElementById('tenantLabel').textContent = user.tenant_id;
        }

        async function apiFetch(url) {
            const res = await fetch(`${API}${url}`, { headers: { 'Authorization': `Bearer ${token}` } });
            if (res.status === 401) { logout(); throw new Error('Expired'); }
            return res.json();
        }

        async function loadAgentDashboard() {
            try {
                const [metrics, calls] = await Promise.all([
                    apiFetch(`/api/analytics/agents/${user.id}`),
                    apiFetch(`/api/calls?agent_id=${user.id}&limit=50`)
                ]);
                agentCalls = calls.calls || [];
                renderStats(metrics);
                renderRecentCalls(agentCalls);
                renderAllCalls(agentCalls);
                renderTranscripts(agentCalls);
            } catch (e) { console.error(e); }
        }

        function sentimentPill(score) {
            if (score == null) return '<span style="color:var(--text-muted)">‚Äî</span>';
            if (score >= 0.3) return `<span class="sentiment-pill s-positive">üòä ${score.toFixed(2)}</span>`;
            if (score >= -0.3) return `<span class="sentiment-pill s-neutral">üòê ${score.toFixed(2)}</span>`;
            return `<span class="sentiment-pill s-negative">üòü ${score.toFixed(2)}</span>`;
        }

        function intentBadge(intent) {
            if (!intent) return '<span style="color:var(--text-muted)">‚Äî</span>';
            return `<span class="intent-badge i-${intent}">${intent}</span>`;
        }

        function renderStats(m) {
            const aht = m.average_handle_time || 0;
            const aiCalls = agentCalls.filter(c => c.intent).length;
            document.getElementById('statsRow').innerHTML = `
                <div class="stat-card"><div class="stat-label">Total Calls</div><div class="stat-value" style="color:var(--blue)">${m.total_calls}</div></div>
                <div class="stat-card"><div class="stat-label">Avg Handle Time</div><div class="stat-value" style="color:var(--green)">${Math.floor(aht / 60)}:${(aht % 60).toString().padStart(2, '0')}</div></div>
                <div class="stat-card"><div class="stat-label">FCR Rate</div><div class="stat-value" style="color:var(--purple)">${m.first_call_resolution_rate}%</div></div>
                <div class="stat-card"><div class="stat-label">Avg Sentiment</div><div class="stat-value" style="color:${m.avg_sentiment >= 0.3 ? 'var(--green)' : m.avg_sentiment >= -0.3 ? 'var(--orange)' : 'var(--red)'}">${m.avg_sentiment}</div></div>
                <div class="stat-card"><div class="stat-label">AI Analyzed</div><div class="stat-value" style="color:var(--cyan)">ü§ñ ${aiCalls}</div></div>
            `;
        }

        function renderRecentCalls(calls) {
            document.getElementById('myCallCount').textContent = calls.length;
            const rows = calls.slice(0, 15).map(c => {
                const dur = c.duration ? `${Math.floor(c.duration / 60)}:${(c.duration % 60).toString().padStart(2, '0')}` : '‚Äî';
                return `<tr onclick="showCallDetail('${c.id}', 'dashboard')">
                    <td style="color:var(--text-muted)">${new Date(c.started_at).toLocaleDateString('tr-TR')} ${new Date(c.started_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })}</td>
                    <td><span class="badge ${c.call_type === 'inbound' ? 'b-blue' : 'b-purple'}">${c.call_type === 'inbound' ? 'üì•' : 'üì§'} ${c.call_type}</span></td>
                    <td style="font-family:monospace;font-size:12px">${c.caller_number || c.callee_number || '‚Äî'}</td>
                    <td>${c.queue_name || '‚Äî'}</td>
                    <td>${dur}</td>
                    <td>${sentimentPill(c.sentiment_score)}</td>
                    <td>${intentBadge(c.intent)}</td>
                    <td>${c.resolution_status || '‚Äî'}</td>
                </tr>`;
            }).join('');
            document.getElementById('recentCallsBody').innerHTML = `<table><thead><tr><th>Time</th><th>Type</th><th>Number</th><th>Queue</th><th>Duration</th><th>Sentiment</th><th>Intent</th><th>Resolution</th></tr></thead><tbody>${rows}</tbody></table>`;
        }

        function renderAllCalls(calls) {
            const rows = calls.map(c => {
                const dur = c.duration ? `${Math.floor(c.duration / 60)}:${(c.duration % 60).toString().padStart(2, '0')}` : '‚Äî';
                return `<tr onclick="showCallDetail('${c.id}', 'calls')">
                    <td style="color:var(--text-muted)">${new Date(c.started_at).toLocaleString('tr-TR')}</td>
                    <td><span class="badge ${c.call_type === 'inbound' ? 'b-blue' : 'b-purple'}">${c.call_type}</span></td>
                    <td style="font-family:monospace;font-size:12px">${c.caller_number || c.callee_number || '‚Äî'}</td>
                    <td>${c.queue_name || '‚Äî'}</td>
                    <td>${dur}</td>
                    <td><span class="badge ${c.status === 'completed' ? 'b-green' : 'b-red'}">${c.status}</span></td>
                    <td>${sentimentPill(c.sentiment_score)}</td>
                    <td>${intentBadge(c.intent)}</td>
                </tr>`;
            }).join('');
            document.getElementById('allCallsBody').innerHTML = `<table><thead><tr><th>Date</th><th>Type</th><th>Number</th><th>Queue</th><th>Duration</th><th>Status</th><th>Sentiment</th><th>Intent</th></tr></thead><tbody>${rows}</tbody></table>`;
        }

        function renderTranscripts(calls) {
            const completed = calls.filter(c => c.transcript_text);
            document.getElementById('transcriptList').innerHTML = completed.slice(0, 10).map(c => `
                <div class="panel" style="margin-bottom:12px;cursor:pointer" onclick="showCallDetail('${c.id}', 'transcript')">
                    <div class="panel-header">
                        <span>${new Date(c.started_at).toLocaleString('tr-TR')} ‚Äî ${c.call_type} ‚Äî ${c.queue_name || 'N/A'}</span>
                        <div style="display:flex;gap:8px;align-items:center">
                            ${intentBadge(c.intent)}
                            ${sentimentPill(c.sentiment_score)}
                        </div>
                    </div>
                    <div style="padding:14px">
                        ${c.ai_summary ? `<div style="font-size:13px;color:var(--cyan);margin-bottom:8px">ü§ñ ${c.ai_summary}</div>` : ''}
                        <div class="transcript-box" style="max-height:150px">${c.transcript_text}</div>
                    </div>
                </div>
            `).join('');
        }

        async function showCallDetail(callId, fromTab) {
            previousTab = fromTab || 'dashboard';
            try {
                const c = await apiFetch(`/api/calls/${callId}`);
                const dur = c.duration ? `${Math.floor(c.duration / 60)}m ${c.duration % 60}s` : '‚Äî';

                document.getElementById('detailContent').innerHTML = `
                    <div class="panel">
                        <div class="panel-header">
                            <span>üìû Call ${c.call_type === 'inbound' ? 'üì• Inbound' : 'üì§ Outbound'} ‚Äî ${c.id.slice(0, 8)}</span>
                            <span style="color:var(--text-muted);font-size:12px">${new Date(c.started_at).toLocaleString('tr-TR')}</span>
                        </div>
                        <div style="padding:20px">
                            <div class="detail-grid">
                                <div class="detail-item"><div class="detail-label">Caller</div><div class="detail-value">${c.caller_number || '‚Äî'}</div></div>
                                <div class="detail-item"><div class="detail-label">Duration</div><div class="detail-value">${dur}</div></div>
                                <div class="detail-item"><div class="detail-label">Queue</div><div class="detail-value">${c.queue_name || '‚Äî'}</div></div>
                                <div class="detail-item"><div class="detail-label">Status</div><div class="detail-value"><span class="badge ${c.status === 'completed' ? 'b-green' : 'b-red'}">${c.status}</span></div></div>
                                <div class="detail-item"><div class="detail-label">Sentiment</div><div class="detail-value">${sentimentPill(c.sentiment_score)}</div></div>
                                <div class="detail-item"><div class="detail-label">Intent</div><div class="detail-value">${intentBadge(c.intent)}</div></div>
                                <div class="detail-item"><div class="detail-label">Resolution</div><div class="detail-value">${c.resolution_status || '‚Äî'}</div></div>
                                <div class="detail-item"><div class="detail-label">Recording</div><div class="detail-value">${c.recording_url ? 'üéôÔ∏è Available' : '‚Äî'}</div></div>
                            </div>

                            ${c.ai_summary ? `<div class="ai-card">
                                <h4>ü§ñ AI Summary</h4>
                                <p>${c.ai_summary}</p>
                            </div>` : ''}

                            ${c.ai_next_action ? `<div class="ai-card">
                                <h4>‚ö° Suggested Next Action</h4>
                                <p>${c.ai_next_action}</p>
                            </div>` : ''}

                            ${c.transcript_text ? `<div class="ai-card">
                                <h4>üìù Transcript</h4>
                                <div class="transcript-box">${c.transcript_text}</div>
                            </div>` : ''}
                        </div>
                    </div>
                `;

                // Switch to detail tab
                document.querySelectorAll('[id^="tab-"]').forEach(el => el.style.display = 'none');
                document.getElementById('tab-detail').style.display = 'block';
            } catch (e) { console.error(e); }
        }

        function goBackFromDetail() {
            document.getElementById('tab-detail').style.display = 'none';
            document.getElementById(`tab-${previousTab}`).style.display = 'block';
        }

        function showTab(name) {
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.style.display = 'none');
            document.getElementById(`tab-${name}`).style.display = 'block';
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
        }

        // Auto-login
        (function () {
            const t = localStorage.getItem('agent_token');
            const u = localStorage.getItem('agent_user');
            if (t && u) {
                token = t; user = JSON.parse(u);
                document.getElementById('authOverlay').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
                renderProfile();
                loadAgentDashboard();
            }
        })();
    </script>
</body>

</html>